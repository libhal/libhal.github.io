
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../dma_tutorial/">
      
      
        <link rel="next" href="../architecture/">
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>⬆️ Upgrade Device Library to 3.x.y - libhal</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#upgrading-a-device-library-from-libhal-2xy-to-3xy" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
You're not viewing the latest version.
<a href="../../..">
  <strong>Click here to go to latest.</strong>
</a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="libhal" class="md-header__button md-logo" aria-label="libhal" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            libhal
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ⬆️ Upgrade Device Library to 3.x.y
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/libhal/libhal/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    libhal
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  🏡 Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../getting_started/" class="md-tabs__link">
        
  
    
  
  🚀 Getting Started

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../user_guide/setup_vscode/" class="md-tabs__link">
          
  
  📖 User Guide

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../education/embedded_systems/" class="md-tabs__link">
          
  
  🏫 Education

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../philosophy/" class="md-tabs__link">
          
  
  📚 Contributor Guides

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../project_information/status/" class="md-tabs__link">
          
  
  📊 Project Information

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../api/index.html" class="md-tabs__link">
        
  
    
  
  🧩 APIs

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="libhal" class="md-nav__button md-logo" aria-label="libhal" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    libhal
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/libhal/libhal/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    libhal
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🏡 Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🚀 Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    📖 User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            📖 User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/setup_vscode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🧑🏿‍💻 Setting up VSCode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/fundamentals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🧱 Fundamentals of libhal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/interfaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🔗 Interfaces in libhal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/debugging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🎯 Debugging Firmware
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/error_handling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🪤 Error Handling in libhal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/policy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ⚖️ Policies & FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    🏫 Education
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            🏫 Education
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../education/embedded_systems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What are Embedded Systems?
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../education/bitmasking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bit Masking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../education/architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Microcontroller Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../education/gpio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    General Purpose I/O
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../education/dma/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DMA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../education/timers_and_counters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Timers & Counters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../education/adc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ADC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../education/pwm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PWM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../education/spi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SPI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../education/uart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UART
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../education/i2c/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    I2C
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../education/dac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DAC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../education/canbus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CAN BUS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../education/sensors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basics of Sensors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../education/actuators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basics of Actuators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../education/rtos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RTOS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../education/tbd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TBD
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    📚 Contributor Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            📚 Contributor Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../philosophy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    📜 Design Philosophy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../organization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🗃️ Organization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../style/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🎨 Style Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../interface_design/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🔗 Interface Design Philosophy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../library_guides/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🔹 Library Development Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../arm_cortex_m_bringup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🧠 ARM Cortex M Bring Up
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dma_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ⏩ DMA Tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    ⬆️ Upgrade Device Library to 3.x.y
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    ⬆️ Upgrade Device Library to 3.x.y
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-set-the-ciyml-to-the-following" class="md-nav__link">
    <span class="md-ellipsis">
      (1) Set the ci.yml to the following
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-add-a-release-yaml-file-with-the-next-version-of-the-library" class="md-nav__link">
    <span class="md-ellipsis">
      (2) Add a release yaml file with the next version of the library
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-refactor-library-conanfilepy-found-at-the-root-of-the-repo" class="md-nav__link">
    <span class="md-ellipsis">
      (3) Refactor library conanfile.py (found at the root of the repo)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-update-cmakeliststxt" class="md-nav__link">
    <span class="md-ellipsis">
      (4) Update CMakeLists.txt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-update-test_packagecmakeliststxt" class="md-nav__link">
    <span class="md-ellipsis">
      (5) Update test_package/CMakeLists.txt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-update-test_packageconanfilepy" class="md-nav__link">
    <span class="md-ellipsis">
      (5) Update test_package/conanfile.py
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-replace-demosconanfilepy" class="md-nav__link">
    <span class="md-ellipsis">
      (5) Replace demos/conanfile.py
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-replace-demoscmakeliststxt" class="md-nav__link">
    <span class="md-ellipsis">
      (6) Replace demos/CMakeLists.txt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-refactor-code" class="md-nav__link">
    <span class="md-ellipsis">
      (7) Refactor code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-refactor-tests_package" class="md-nav__link">
    <span class="md-ellipsis">
      (8) Refactor tests_package/
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-refactor-tests" class="md-nav__link">
    <span class="md-ellipsis">
      (8) Refactor tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-refactor-test_package" class="md-nav__link">
    <span class="md-ellipsis">
      (7) Refactor test_package
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#questions" class="md-nav__link">
    <span class="md-ellipsis">
      Questions?
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🏗️ Architectural Design Decisions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    📊 Project Information
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            📊 Project Information
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project_information/status/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🟢 Library Status 🔴
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project_information/about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🧩 APIs
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="upgrading-a-device-library-from-libhal-2xy-to-3xy">Upgrading a Device Library from libhal 2.x.y to 3.x.y</h1>
<p>This guide is for device, utility, RTOS, or any other cross platform libraries that need to be ported from libhal 2.x.y to 3.x.y.</p>
<p>The upgrade to libhal 3.x.y is a breaking change for everything so their major
number for your library will need to be updated. So if the previous version was
2.1.5, then its new version is 3.0.0. If the version was 3.0.1, then the next
is 4.0.0. Remember that version for later because everywhere in this code with
where you see <code>3.0.0</code> replace it with the correct version for your library.</p>
<h2 id="1-set-the-ciyml-to-the-following">(1) Set the <code>ci.yml</code> to the following</h2>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">✅ CI</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<span class="w">  </span><span class="nt">schedule</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cron</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0</span><span class="nv"> </span><span class="s">12</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">0&quot;</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ci</span><span class="p">:</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">libhal/ci/.github/workflows/library_check.yml@5.x.y</span>
<span class="w">    </span><span class="nt">secrets</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inherit</span>

<span class="w">  </span><span class="nt">deploy_cortex-m4f_check</span><span class="p">:</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">libhal/ci/.github/workflows/deploy.yml@5.x.y</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">arch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cortex-m4f</span><span class="w"> </span><span class="c1"># Replace with correct architecture</span>
<span class="w">      </span><span class="nt">os</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">baremetal</span>
<span class="w">      </span><span class="nt">compiler</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcc</span>
<span class="w">      </span><span class="nt">compiler_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">12.3</span>
<span class="w">      </span><span class="nt">compiler_package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arm-gnu-toolchain</span>
<span class="w">    </span><span class="nt">secrets</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inherit</span>

<span class="w">  </span><span class="nt">demo_check</span><span class="p">:</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">libhal/ci/.github/workflows/demo_builder.yml@5.x.y</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">compiler_profile_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/libhal/arm-gnu-toolchain.git</span>
<span class="w">      </span><span class="nt">compiler_profile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1/arm-gcc-12.3</span>
<span class="w">      </span><span class="nt">platform_profile_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/libhal/libhal-lpc40.git</span>
<span class="w">      </span><span class="nt">platform_profile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2/lpc4078</span><span class="w"> </span><span class="c1"># replace if you are not using lpc4078</span>
<span class="w">    </span><span class="nt">secrets</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inherit</span>
</code></pre></div>
<p>This will handle everything you need for checking your library conforms to the
libhal standards.</p>
<h2 id="2-add-a-release-yaml-file-with-the-next-version-of-the-library">(2) Add a release yaml file with the next version of the library</h2>
<p>The new scheme for launching versions is to have a workflow dispatch action
file. This action must be manually invoked to launch a version. This allows for
more control over which versions are deployed to the server as well as launching revisions if a dependency has a bug but a client cannot upgrade the
library version.</p>
<p>The file name in the <code>.github</code> file will be <code>X.0.0.yml</code> where X is the next major version number.</p>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">🚀 Deploy 3.0.0</span><span class="w"> </span><span class="c1"># Replace with the next major version</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">libhal/ci/.github/workflows/deploy_all.yml@5.x.y</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.0.0</span><span class="w"> </span><span class="c1"># Replace with the next major version must match the title</span>
<span class="w">    </span><span class="nt">secrets</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inherit</span>
</code></pre></div>
<h2 id="3-refactor-library-conanfilepy-found-at-the-root-of-the-repo">(3) Refactor library <code>conanfile.py</code> (found at the root of the repo)</h2>
<p>Replace the contents of the file with the data below:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Copyright 2024 Khalil Estell</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">conan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConanFile</span>

<span class="n">required_conan_version</span> <span class="o">=</span> <span class="s2">&quot;&gt;=2.0.14&quot;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">libhal___device___conan</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;libhal-__device__&quot;</span>
    <span class="n">license</span> <span class="o">=</span> <span class="s2">&quot;Apache-2.0&quot;</span>
    <span class="n">homepage</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/libhal/libhal-__device__&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;... fill this out ...&quot;</span><span class="p">)</span>
    <span class="n">topics</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;... fill this out ...&quot;</span><span class="p">)</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="s2">&quot;compiler&quot;</span><span class="p">,</span> <span class="s2">&quot;build_type&quot;</span><span class="p">,</span> <span class="s2">&quot;os&quot;</span><span class="p">,</span> <span class="s2">&quot;arch&quot;</span>

    <span class="n">python_requires</span> <span class="o">=</span> <span class="s2">&quot;libhal-bootstrap/[^1.0.0]&quot;</span>
    <span class="n">python_requires_extend</span> <span class="o">=</span> <span class="s2">&quot;libhal-bootstrap.library&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bootstrap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">python_requires</span><span class="p">[</span><span class="s2">&quot;libhal-bootstrap&quot;</span><span class="p">]</span>
        <span class="n">bootstrap</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">add_library_requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">package_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">libs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;libhal-__device__&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpp_info</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;cmake_target_name&quot;</span><span class="p">,</span> <span class="s2">&quot;libhal::__device__&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Replace every instance of <code>__device__</code> with the name of the library.</p>
<div class="highlight"><pre><span></span><code>    <span class="n">description</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;... fill this out ...&quot;</span><span class="p">)</span>
    <span class="n">topics</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;... fill this out ...&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Fill the <code>description</code> and <code>topics</code> sections based on what they were before.</p>
<h2 id="4-update-cmakeliststxt">(4) Update CMakeLists.txt</h2>
<p>Remove the following packages and link libraries from your CMake file. These
are now automatically linked against your library when you use
<code>libhal_test_and_make_library</code>.</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="err">PACKAGES</span>
<span class="w">  </span><span class="err">libhal</span>
<span class="w">  </span><span class="err">libhal-util</span>

<span class="w">  </span><span class="err">LINK_LIBRARIES</span>
<span class="w">  </span><span class="err">libhal::libhal</span>
<span class="w">  </span><span class="err">libhal::util</span>
</code></pre></div>
<h2 id="5-update-test_packagecmakeliststxt">(5) Update <code>test_package/CMakeLists.txt</code></h2>
<p>Replace it with this, update <code>__device__</code> to the correct library name:</p>
<div class="highlight"><pre><span></span><code><span class="c"># Copyright 2024 Khalil Estell</span>
<span class="c">#</span>
<span class="c"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c"># you may not use this file except in compliance with the License.</span>
<span class="c"># You may obtain a copy of the License at</span>
<span class="c">#</span>
<span class="c"># http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c">#</span>
<span class="c"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c"># See the License for the specific language governing permissions and</span>
<span class="c"># limitations under the License.</span>

<span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.15</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">test_package</span><span class="w"> </span><span class="s">LANGUAGES</span><span class="w"> </span><span class="s">CXX</span><span class="p">)</span>

<span class="nb">find_package</span><span class="p">(</span><span class="s">libhal-__device__</span><span class="w"> </span><span class="s">REQUIRED</span><span class="w"> </span><span class="s">CONFIG</span><span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="s">main.cpp</span><span class="p">)</span>
<span class="nb">target_include_directories</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="s">.</span><span class="p">)</span>
<span class="nb">target_compile_features</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="s">PRIVATE</span><span class="w"> </span><span class="s">cxx_std_20</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="s">PRIVATE</span><span class="w"> </span><span class="s">libhal::__device__</span><span class="p">)</span>
</code></pre></div>
<h2 id="5-update-test_packageconanfilepy">(5) Update <code>test_package/conanfile.py</code></h2>
<p>Replace it with this:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Copyright 2024 Khalil Estell</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">conan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConanFile</span>


<span class="k">class</span><span class="w"> </span><span class="nc">TestPackageConan</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="s2">&quot;os&quot;</span><span class="p">,</span> <span class="s2">&quot;arch&quot;</span><span class="p">,</span> <span class="s2">&quot;compiler&quot;</span><span class="p">,</span> <span class="s2">&quot;build_type&quot;</span>

    <span class="n">python_requires</span> <span class="o">=</span> <span class="s2">&quot;libhal-bootstrap/[^1.0.0]&quot;</span>
    <span class="n">python_requires_extend</span> <span class="o">=</span> <span class="s2">&quot;libhal-bootstrap.library_test_package&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tested_reference_str</span><span class="p">)</span>
</code></pre></div>
<h2 id="5-replace-demosconanfilepy">(5) Replace <code>demos/conanfile.py</code></h2>
<p>Replace it with the following:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Copyright 2024 Khalil Estell</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">conan</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConanFile</span>


<span class="k">class</span><span class="w"> </span><span class="nc">demos</span><span class="p">(</span><span class="n">ConanFile</span><span class="p">):</span>
    <span class="n">python_requires</span> <span class="o">=</span> <span class="s2">&quot;libhal-bootstrap/[^1.0.0]&quot;</span>
    <span class="n">python_requires_extend</span> <span class="o">=</span> <span class="s2">&quot;libhal-bootstrap.demo&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bootstrap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">python_requires</span><span class="p">[</span><span class="s2">&quot;libhal-bootstrap&quot;</span><span class="p">]</span>
        <span class="n">bootstrap</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">add_demo_requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># Change 3.0.0 to the correct major release number</span>
        <span class="c1"># Replace __device__ with the name of the library</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">(</span><span class="s2">&quot;libhal-__device__/[^3.0.0 || latest]&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>You may be wonder why we have <code>|| latest</code> for the version range. "latest" is the version used by CI to ensure that the demo builds using the "latest"
version built on the CI's virtual machine. It isn't a valid libhal version for a library, so we can use it for CI purposes.</p>
</div>
<h2 id="6-replace-demoscmakeliststxt">(6) Replace <code>demos/CMakeLists.txt</code></h2>
<div class="highlight"><pre><span></span><code><span class="c"># Copyright 2024 Khalil Estell</span>
<span class="c">#</span>
<span class="c"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c"># you may not use this file except in compliance with the License.</span>
<span class="c"># You may obtain a copy of the License at</span>
<span class="c">#</span>
<span class="c"># http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c">#</span>
<span class="c"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c"># See the License for the specific language governing permissions and</span>
<span class="c"># limitations under the License.</span>

<span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.20</span><span class="p">)</span>

<span class="nb">project</span><span class="p">(</span><span class="s">demos</span><span class="w"> </span><span class="s">LANGUAGES</span><span class="w"> </span><span class="s">CXX</span><span class="p">)</span>

<span class="nb">libhal_build_demos</span><span class="p">(</span>
<span class="w">    </span><span class="s">DEMOS</span>
<span class="w">    </span><span class="s">demo1</span>
<span class="w">    </span><span class="s">demo2</span>
<span class="w">    </span><span class="c"># Add more demos if applicable</span>

<span class="w">    </span><span class="s">PACKAGES</span>
<span class="w">    </span><span class="s">libhal-__device__</span>

<span class="w">    </span><span class="s">LINK_LIBRARIES</span>
<span class="w">    </span><span class="s">libhal::__device__</span>
<span class="p">)</span>
</code></pre></div>
<p><code>libhal</code>, <code>libhal-util</code>, and <code>libhal-__platform__</code> (where <code>__platform__</code> is
the platform defined in your platform profile file), are automatically
searched for and linked into your project, so you only need to link in your
library and any others that are needed for the demos to build correctly.</p>
<p>Add any other additional packages that are linked in beyond the <code>__device__</code>.</p>
<p>Replace <code>demo1</code> and <code>demo2</code> with the correct demo names in the <code>applications</code>
directory. Demos have the name <code>demo_name.cpp</code>, and the name you put in the
<code>DEMOS</code> list is their name without the <code>.cpp</code> extension.</p>
<h2 id="7-refactor-code">(7) Refactor code</h2>
<p>This is where the fun bit comes in. Now that all of the interfaces have been
modified, Each header and cpp file that uses them will need to fixed up.</p>
<ol>
<li>For every api that inherits an interface, update the APIs for derived class
   to match the new interface.</li>
<li>Replace factory functions with constructors (make functions should stay the
   same as they were before).</li>
<li>Use exceptions rather than <code>return hal::new_error()</code>. Make sure to use
   <code>hal::safe_throw</code> instead of <code>throw</code> directly. To know which exception to
   throw you MUST read the <code>libhal/error.hpp</code> file and determine which
   exception fits the best. If none of them seem to fit, join the discord and
   ask about it in the "discussions" channel. Also consider leaving an issue on the <code>libhal/libhal</code> repo about the error you'd like to add to the list or if you aren't sure. See <code>std::errc</code> for the list of error codes we use to make our exceptions.</li>
</ol>
<h2 id="8-refactor-tests_package">(8) Refactor <code>tests_package/</code></h2>
<p>Update the test package to use the newly refactored code. If there is nothing
in the <code>main.cpp</code> besides including a header file, then leave it as is.</p>
<h2 id="8-refactor-tests">(8) Refactor tests</h2>
<p>This shouldn't be too hard. Apply the same techniques used in refactor code.
Be sure to look at <code>libhal-util</code>, <code>libhal-soft</code> and <code>libhal-mock</code> to get an idea of what is needed for the refactor. Remove all of the checks for success
status such as:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="n">expect</span><span class="p">(</span><span class="o">!</span><span class="n">result1</span><span class="p">);</span>
<span class="w">  </span><span class="n">expect</span><span class="p">(</span><span class="o">!</span><span class="n">result2</span><span class="p">);</span>
<span class="w">  </span><span class="n">expect</span><span class="p">(</span><span class="o">!</span><span class="n">result3</span><span class="p">);</span>
<span class="w">  </span><span class="n">expect</span><span class="p">(</span><span class="o">!</span><span class="n">result4</span><span class="p">);</span>
<span class="w">  </span><span class="n">expect</span><span class="p">(</span><span class="o">!</span><span class="n">result5</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// or</span>

<span class="w">  </span><span class="n">expect</span><span class="p">(</span><span class="kt">bool</span><span class="p">{</span><span class="w"> </span><span class="n">result1</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="n">expect</span><span class="p">(</span><span class="kt">bool</span><span class="p">{</span><span class="w"> </span><span class="n">result2</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="n">expect</span><span class="p">(</span><span class="kt">bool</span><span class="p">{</span><span class="w"> </span><span class="n">result3</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="n">expect</span><span class="p">(</span><span class="kt">bool</span><span class="p">{</span><span class="w"> </span><span class="n">result4</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="n">expect</span><span class="p">(</span><span class="kt">bool</span><span class="p">{</span><span class="w"> </span><span class="n">result5</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>
<p>To test for a thrown exception use the following pattern:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="n">expect</span><span class="p">(</span><span class="k">throws</span><span class="o">&lt;</span><span class="n">hal</span><span class="o">::</span><span class="n">argument_out_of_domain</span><span class="o">&gt;</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">test_subject_object</span><span class="p">.</span><span class="n">function_that_will_throw</span><span class="p">(</span><span class="n">input_that_will_cause_throw</span><span class="p">);</span>
<span class="w">  </span><span class="p">}));</span>
</code></pre></div>
<p><code>throws</code> checks if an exception of a particular type is thrown and will catch it and return an expectation value. It takes a lambda or any other callable,
that invokes the throwing behavior. If the calls do not throw an exception then
throws fails and reports that to the user.</p>
<h2 id="7-refactor-test_package">(7) Refactor test_package</h2>
<p>Remove any code needed for boost.</p>
<div class="highlight"><pre><span></span><code><span class="k">namespace</span><span class="w"> </span><span class="nn">boost</span><span class="w"> </span><span class="p">{</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">throw_exception</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">hal</span><span class="o">::</span><span class="n">halt</span><span class="p">();</span>
<span class="p">}</span>
<span class="p">}</span><span class="w">  </span><span class="c1">// namespace boost</span>
</code></pre></div>
<p>Remove anything that is target specific in the test package such as cross
compile flags. Those flags MUST be removed and only handled by the compiler.</p>
<p>Update the test package to make the new APIs.</p>
<h2 id="questions">Questions?</h2>
<p>If you have any questions please post them in the <code>discussions</code> channel in
discord. Make sure to make it a thread so the main channel is not overwhelmed
with messages.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../dma_tutorial/" class="md-footer__link md-footer__link--prev" aria-label="Previous: ⏩ DMA Tutorial">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                ⏩ DMA Tutorial
              </div>
            </div>
          </a>
        
        
          
          <a href="../architecture/" class="md-footer__link md-footer__link--next" aria-label="Next: 🏗️ Architectural Design Decisions">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                🏗️ Architectural Design Decisions
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "content.tabs.link", "toc.integrate", "navigation.tracking", "navigation.footer"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>