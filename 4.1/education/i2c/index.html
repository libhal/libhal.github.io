
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../uart/">
      
      
        <link rel="next" href="../dac/">
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.45">
    
    
      
        <title>I2C - libhal</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#i2c-inter-integrated-circuit" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
You're not viewing the latest version.
<a href="../../..">
  <strong>Click here to go to latest.</strong>
</a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="libhal" class="md-header__button md-logo" aria-label="libhal" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            libhal
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              I2C
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/libhal/libhal/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    libhal
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  üè° Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../getting_started/" class="md-tabs__link">
        
  
    
  
  üöÄ Getting Started

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../user_guide/setup_vscode/" class="md-tabs__link">
          
  
  üìñ User Guide

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../embedded_systems/" class="md-tabs__link">
          
  
  üè´ Education

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../contributor_guide/philosophy/" class="md-tabs__link">
          
  
  üìö Contributor Guides

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../project_information/status/" class="md-tabs__link">
          
  
  üìä Project Information

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../api/" class="md-tabs__link">
        
  
    
  
  üß© APIs

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="libhal" class="md-nav__button md-logo" aria-label="libhal" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    libhal
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/libhal/libhal/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    libhal
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üè° Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üöÄ Getting Started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    üìñ User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            üìñ User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/setup_vscode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üßëüèø‚Äçüíª Setting up VSCode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/fundamentals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üß± Fundamentals of libhal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/interfaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üîó Interfaces in libhal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/debugging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üéØ Debugging Firmware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/error_handling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ü™§ Error Handling in libhal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/policy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ‚öñÔ∏è Policies & FAQ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    üè´ Education
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            üè´ Education
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../embedded_systems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What are Embedded Systems?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bitmasking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bit Masking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Microcontroller Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gpio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    General Purpose I/O
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dma/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DMA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../timers_and_counters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Timers & Counters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ADC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PWM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SPI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../uart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UART
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    I2C
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    I2C
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-i2c" class="md-nav__link">
    <span class="md-ellipsis">
      What is i2c?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hali2c-interface-and-how-to-use-it" class="md-nav__link">
    <span class="md-ellipsis">
      hal::i2c interface and how to use it
    </span>
  </a>
  
    <nav class="md-nav" aria-label="hal::i2c interface and how to use it">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-an-i2c-object" class="md-nav__link">
    <span class="md-ellipsis">
      Creating an i2c object
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-hali2cconfigure" class="md-nav__link">
    <span class="md-ellipsis">
      Using hal::i2c::configure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-hali2ctransaction" class="md-nav__link">
    <span class="md-ellipsis">
      Using hal::i2c::transaction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-libhal-util" class="md-nav__link">
    <span class="md-ellipsis">
      Using libhal-util
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-libraries-that-use-i2c" class="md-nav__link">
    <span class="md-ellipsis">
      Using libraries that use i2c
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using libraries that use i2c">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-do-i-know-if-a-library-needs-i2c" class="md-nav__link">
    <span class="md-ellipsis">
      How do I know if a library needs i2c?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constructing-a-driver-that-needs-i2c" class="md-nav__link">
    <span class="md-ellipsis">
      Constructing a driver that needs i2c
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ensuring-the-correct-clock-rate" class="md-nav__link">
    <span class="md-ellipsis">
      Ensuring the correct clock rate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thread-safety" class="md-nav__link">
    <span class="md-ellipsis">
      Thread safety
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dealing-with-multi-controllers-on-the-bus" class="md-nav__link">
    <span class="md-ellipsis">
      Dealing with multi controllers on the bus
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-an-i2c-device-driver" class="md-nav__link">
    <span class="md-ellipsis">
      Writing an i2c device driver
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementing-an-i2c-driver-on-bare-metal" class="md-nav__link">
    <span class="md-ellipsis">
      Implementing an i2c driver on bare metal
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DAC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../canbus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CAN BUS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sensors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basics of Sensors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../actuators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basics of Actuators
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rtos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RTOS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tbd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TBD
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    üìö Contributor Guides
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            üìö Contributor Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributor_guide/philosophy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üìú Design Philosophy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributor_guide/organization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üóÉÔ∏è Organization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributor_guide/style/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üé® Style Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributor_guide/interface_design/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üîó Interface Design Philosophy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributor_guide/library_guides/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üîπ Library Development Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributor_guide/arm_cortex_m_bringup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üß† ARM Cortex M Bring Up
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributor_guide/dma_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ‚è© DMA Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributor_guide/upgrade_to_libhal_3_device_library/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ‚¨ÜÔ∏è Upgrade Device Library to 3.x.y
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributor_guide/architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üèóÔ∏è Architectural Design Decisions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    üìä Project Information
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            üìä Project Information
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project_information/status/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üü¢ Library Status üî¥
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project_information/about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üß© APIs
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="i2c-inter-integrated-circuit">I2C: Inter-Integrated Circuit</h1>
<p>Welcome to the libhal i2c tutorial. This article will go over:</p>
<ul>
<li>What i2c is</li>
<li>libhal's i2c interface &amp; basic usage</li>
<li>Utility functions for i2c</li>
<li>How to use drivers that use i2c</li>
<li>How to write an i2c device driver</li>
<li>High level steps to write an i2c peripheral driver</li>
</ul>
<p>This tutorial only works with i2c controllers (also known as masters). Target (or slave) i2c will not be discussed here.</p>
<h2 id="what-is-i2c">What is i2c?</h2>
<p>In order to proceed to the rest of this article, you must understand the
fundamentals of i2c and how it works. Rather than rehash what is already out
there, please read one of the following:</p>
<ul>
<li><a href="https://learn.sparkfun.com/tutorials/i2c/all">Sparkfun I2C</a>: Recommended as
  it is concise and provides enough information to be ready for the rest of
  this article.</li>
<li><a href="https://www.i2c-bus.org/">i2c-bus.org</a>: If you want to get into the depths
  of I2C, this website does a great job of going into how the I2C protocol
  works as well as some of its other less known features such as
  multi-controller and clock stretching.</li>
<li><a href="https://www.ti.com/lit/an/sbaa565/sbaa565.pdf">TI's A Basic Guide to I2C</a>:
  Detailed and contains examples of how an i2c transaction works with concrete
  examples with actual i2c device register maps.</li>
</ul>
<h2 id="hali2c-interface-and-how-to-use-it"><code>hal::i2c</code> interface and how to use it</h2>
<p>The interface that provides APIs for i2c communication is
<a href="https://github.com/libhal/libhal/blob/main/include/libhal/i2c.hpp"><code>hal::i2c</code></a>.
It provides two APIs <code>configure</code> and <code>transaction</code>.</p>
<h3 id="creating-an-i2c-object">Creating an i2c object</h3>
<p>Each platform that supports i2c will have their own i2c driver. Typically the name goes like: <code>hal::&lt;platform_name&gt;::i2c</code> or <code>hal::&lt;platform_name&gt;::dma_i2c</code>.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// LPC40xx i2c driver for i2c bus 2</span>
<span class="n">hal</span><span class="o">::</span><span class="n">lpc40</span><span class="o">::</span><span class="n">i2c</span><span class="w"> </span><span class="nf">i2c</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="c1">// stm32f1xx i2c driver for i2c bus 1</span>
<span class="n">hal</span><span class="o">::</span><span class="n">stm32f1</span><span class="o">::</span><span class="n">i2c</span><span class="w"> </span><span class="nf">i2c</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</code></pre></div>
<p>To know what your platform has available you'll need to look at the API docs and search for <code>i2c</code> or look at what inherits <code>hal::i2c</code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The API docs are not available currently. Consider looking at the source code of the libraries for files with the name <code>i2c.hpp</code> or <code>dma_i2c.hpp</code> to find your platform's i2c drivers.</p>
</div>
<h3 id="using-hali2cconfigure">Using <code>hal::i2c::configure</code></h3>
<p>This API takes a const reference to the <code>hal::i2c::settings</code> structure as an input. It currently only contains a single field which is the <code>clock_rate</code>. This field allows the application developer or drivers to change the frequency that the i2c peripheral communicates at.</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">settings</span>
<span class="p">{</span>
<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * @brief The serial clock rate in hertz.</span>
<span class="cm">   *</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="n">hertz</span><span class="w"> </span><span class="n">clock_rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100.0</span><span class="n">_kHz</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>The <code>clock_rate</code> field defaults to 100kHz which is the standard frequency for
i2c. The majority of i2c devices will support 100kHz which makes it a decent
default. Fast mode i2c can operate at 400kHz. Fast mode plus can operate at
1MHz. High speed mode can go up to 3.4MHz. 100kHz to 1MHz are the most common
frequency ranges.</p>
<p><strong>What value should you set this to?</strong> In general, you want your communication
to be as fast as possible so your code isn't stuck waiting for the transfer to
happen. The higher the frequency the less time it takes to transmit or receive
data. But if your bus has multiple devices with different max frequencies, you
MUST choose the frequency of the device with the lowest frequency. This is due
to how all devices must look at the same i2c bus lines to determine if they
have been selected for a transaction, and if the frequency is too fast for them
to sample, then they will either not respond or potentially respond
incorrectly, leading to errors such as "device not found" or I/O errors.</p>
<h3 id="using-hali2ctransaction">Using <code>hal::i2c::transaction</code></h3>
<p>In order to communicate with an i2c you must perform an i2c transaction where you specify the device you want to talk to, the data you want to send to it and the amount of data you want back from it. There are 3 types of transactions:</p>
<ol>
<li><code>Write</code>: Where the controller writes to the device and get nothing back in return.</li>
<li><code>Read</code>: Where the controller reads from a device.</li>
<li><code>Write-then-Read</code>: Where the controller performs a write operation then performs a read operation.</li>
</ol>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Most i2c devices will use <code>Write</code> and <code>Write-then-Read</code> operations. A lone <code>Read</code> operation is very rare. Typically write operations are used to write data or configuration settings to a device. <code>Write-then-read</code> operations are used for reading data from most devices. The write phase of the operation <code>Write-then-read</code> is used to tell the device "what" data you want to read, then performing a read operation to read the data back out. The "what" for most devices is usually an address of a register you want to read. Most i2c devices are memory mapped in this way.</p>
<p>Some devices cannot support <code>Write-then-Read</code> and thus they need the <code>Write</code> and <code>Read</code> operations to be separate.</p>
<p>An example of a device with a <code>Read</code> operation without a <code>Write</code> would be the i2c mux <a href="https://cdn-shop.adafruit.com/datasheets/tca9548a.pdf">tca9548a</a>. In this case, there is only 1 register you can write to or read from, thus the "what" for each transaction is just that register.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="n">transaction</span><span class="p">(</span><span class="n">hal</span><span class="o">::</span><span class="n">byte</span><span class="w"> </span><span class="n">p_address</span><span class="p">,</span>
<span class="w">                 </span><span class="n">std</span><span class="o">::</span><span class="n">span</span><span class="o">&lt;</span><span class="n">hal</span><span class="o">::</span><span class="n">byte</span><span class="w"> </span><span class="k">const</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p_data_out</span><span class="p">,</span>
<span class="w">                 </span><span class="n">std</span><span class="o">::</span><span class="n">span</span><span class="o">&lt;</span><span class="n">hal</span><span class="o">::</span><span class="n">byte</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p_data_in</span><span class="p">,</span>
<span class="w">                 </span><span class="n">hal</span><span class="o">::</span><span class="n">function_ref</span><span class="o">&lt;</span><span class="n">hal</span><span class="o">::</span><span class="n">timeout_function</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p_timeout</span><span class="p">)</span>
</code></pre></div>
<p>Lets break down each of the input parameters:</p>
<ul>
<li><strong>p_address</strong>: is a byte sized parameter that represents the 7-bit i2c
  address of the device you want to communicate with. To perform a transaction
  with a 10-bit address, this parameter must be the address upper byte of the
  10-bit address OR'd with <code>0b1111'0000</code> (the 10-bit address indicator). The
  lower byte of the address must be contained in the first byte of the
  <code>p_data_out</code> span buffer.</li>
<li><strong>p_data_out</strong>: data to be written to the addressed device. Set this to a
  span with <code>size() == 0</code> in order to skip writing.</li>
<li><strong>p_data_in</strong>: buffer to store read data from the addressed device. Set
  this to a span with <code>size() == 0</code> in order to skip reading.</li>
<li><strong>p_timeout</strong>: A function that must throw the type <code>hal::timed_out</code> or a
  derivation of <code>hal::timed_out</code> when the deadline for this operation has
  exceeded its time. The i2c driver implementation must poll this function to
  ensure it is within the function's deadline.</li>
</ul>
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>Unfamiliar with C++'s <code>std::span</code> standard library? Read the article
<a href="https://www.cppstories.com/2023/span-cpp20/">How to use std::span from C++20</a> to learn!</p>
</div>
<p>Here is what a <code>Write-then-Read</code> transaction looks like:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;array&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;libhal/i2c.hpp&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">write_then_read</span><span class="p">(</span><span class="n">hal</span><span class="o">::</span><span class="n">i2c</span><span class="o">&amp;</span><span class="w"> </span><span class="n">i2c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">hal</span><span class="o">::</span><span class="n">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="n">status_register_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mh">0x01</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">hal</span><span class="o">::</span><span class="n">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="n">status_register_contents</span><span class="p">{};</span>
<span class="w">  </span><span class="n">i2c</span><span class="p">.</span><span class="n">transaction</span><span class="p">(</span><span class="mh">0x14</span><span class="p">,</span>
<span class="w">                  </span><span class="n">status_register_address</span><span class="p">,</span>
<span class="w">                  </span><span class="n">status_register_contents</span><span class="p">,</span>
<span class="w">                  </span><span class="n">hal</span><span class="o">::</span><span class="n">never_timeout</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>
<p>In this scenario we want to talk to the device with address <code>0x14</code>, the first
parameter. We pass the array <code>status_register_address</code> which implicitly
converts into a <code>std::span</code> as the second parameter. In this case the value of
<code>0x01</code> is the address of the register we want to read from. Next is the
<code>status_register_contents</code> array which has size 1. This will cause the i2c read
to read back a single byte from this register. If multiple bytes are needed for
the read operation, then the size of the array can be increased to read
additional bytes. Finally, the last argument for the timeout function is
<code>hal::never_timeout()</code> which returns a timeout function that never throws
<code>hal::timed_out</code>. This is useful for devices that do not perform clock
stretching. For <code>Write-then-Read</code> transactions, the i2c implementation must handle automatically performing the write operation first, then performing a restart-read operation.</p>
<p>The purpose of <code>p_timeout</code> is to be used when a target device supports clock
stretching. In these situations, it may not be well defined how long the device
will hold the clock lines down for, which can stall a controller if its waiting
for the i2c bus to come back online before the code can proceed. This argument
function allows an escape hatch to return control from the i2c implementation
back to the application or driver code.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>NOTE from Khalil: The <code>p_timeout</code> approach is silly. Yes, its helpful for clock stretching case, but its very rare to find devices that use clock stretching. If most devices supported clock stretching, then having the API take a timeout callback would be acceptable. But its so rare that most code is just passing <code>hal::never_timeout()</code>. <code>p_timeout</code> is also problematic for i2c devices that use DMA. Because this has to be polled, when should the DMA code be running? It could just spin while it waits for DMA to finish processing, but we loose out on the capability to put the device to sleep or switch tasks by using the polling option. Overall, it is likely in the future that we will either make <code>hal::i2c_v2</code> with an <code>hal::io_waiter</code> in place of the <code>p_timeout</code> or eliminate the parameter all together and recommend that i2c implementations accept an <code>io_waiter</code> as an input parameter. The outcome has yet to be decided.</p>
</div>
<p>Here is what a <code>Write</code> transaction looks like:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;array&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;libhal/i2c.hpp&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">write_then_read</span><span class="p">(</span><span class="n">hal</span><span class="o">::</span><span class="n">i2c</span><span class="o">&amp;</span><span class="w"> </span><span class="n">i2c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">hal</span><span class="o">::</span><span class="n">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">config_register_payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mh">0x02</span><span class="p">,</span><span class="w"> </span><span class="mh">0xA2</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="n">i2c</span><span class="p">.</span><span class="n">transaction</span><span class="p">(</span><span class="mh">0x14</span><span class="p">,</span>
<span class="w">                  </span><span class="n">config_register_payload</span><span class="p">,</span>
<span class="w">                  </span><span class="p">{},</span>
<span class="w">                  </span><span class="n">hal</span><span class="o">::</span><span class="n">never_timeout</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>
<p>You can replace the span with just <code>{}</code> and C++ will deduce and brace
initialize the span using its default constructor, which is a span of size 0
and pointer addressed to <code>nullptr</code>. By setting the <code>p_data_in</code> to an empty span, the transaction will only perform a write operation.</p>
<p>Here is what a <code>Read</code> transaction looks like:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;array&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;libhal/i2c.hpp&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">write_then_read</span><span class="p">(</span><span class="n">hal</span><span class="o">::</span><span class="n">i2c</span><span class="o">&amp;</span><span class="w"> </span><span class="n">i2c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">hal</span><span class="o">::</span><span class="n">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="o">&gt;</span><span class="w"> </span><span class="n">buffer</span><span class="p">{};</span>
<span class="w">  </span><span class="n">i2c</span><span class="p">.</span><span class="n">transaction</span><span class="p">(</span><span class="mh">0x14</span><span class="p">,</span>
<span class="w">                  </span><span class="p">{},</span>
<span class="w">                  </span><span class="n">buffer</span><span class="p">,</span>
<span class="w">                  </span><span class="n">hal</span><span class="o">::</span><span class="n">never_timeout</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>
<p>By setting the <code>p_data_out</code> with an empty span, the transaction will only perform a write operation.</p>
<h2 id="using-libhal-util">Using <code>libhal-util</code></h2>
<p>Writing <code>i2c.transaction(0x14, {}, buffer, hal::never_timeout());</code> can be long.
A shorter option is to use the utilities from <code>libhal-util/i2c.hpp</code>. Take a look at the following code:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;array&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;libhal/i2c.hpp&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;libhal-util/i2c.hpp&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">testing_libhal_util</span><span class="p">(</span><span class="n">hal</span><span class="o">::</span><span class="n">i2c</span><span class="o">&amp;</span><span class="w"> </span><span class="n">i2c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// These are stand ins</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">hal</span><span class="o">::</span><span class="n">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="n">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mh">0xA2</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">hal</span><span class="o">::</span><span class="n">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">buffer</span><span class="p">{};</span>

<span class="w">  </span><span class="c1">// Write `payload` to [the device with the] address 0x23</span>
<span class="w">  </span><span class="n">hal</span><span class="o">::</span><span class="n">write</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x23</span><span class="p">,</span><span class="w"> </span><span class="n">payload</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Fill `buffer` with data read from address 0x33</span>
<span class="w">  </span><span class="n">hal</span><span class="o">::</span><span class="n">read</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x33</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Return a buffer of 4 bytes with 4 bytes of data read from address 0x33</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">hal</span><span class="o">::</span><span class="n">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="o">&gt;</span><span class="w"> </span><span class="n">response0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hal</span><span class="o">::</span><span class="n">read</span><span class="o">&lt;</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x33</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// You can also use the &quot;auto&quot; keyword to shorten the line. The type will be a</span>
<span class="w">  </span><span class="c1">// hal::array&lt;hal::byte, N&gt; where N is the integral template (the &lt;4&gt;)</span>
<span class="w">  </span><span class="c1">// argument.</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">response0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hal</span><span class="o">::</span><span class="n">read</span><span class="o">&lt;</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x33</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Two ways to write `payload` to address 0x23 and fill `buffer` with the</span>
<span class="w">  </span><span class="c1">// response.</span>
<span class="w">  </span><span class="n">hal</span><span class="o">::</span><span class="n">write_then_read</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x23</span><span class="p">,</span><span class="w"> </span><span class="n">payload</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">);</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">response1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hal</span><span class="o">::</span><span class="n">write_then_read</span><span class="o">&lt;</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x33</span><span class="p">,</span><span class="w"> </span><span class="n">payload</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Check if the device responds on the bus. Returns true if the device</span>
<span class="w">  </span><span class="c1">// acknowledges the address 0x10.</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hal</span><span class="o">::</span><span class="n">probe</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Device did acknowledge</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Device did NOT acknowledge</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="using-libraries-that-use-i2c">Using libraries that use i2c</h2>
<h3 id="how-do-i-know-if-a-library-needs-i2c">How do I know if a library needs i2c?</h3>
<p>If the library's constructor requires a <code>hal::i2c&amp;</code>, then that library needs i2c to operate. This goes for any other libhal interface as well.</p>
<h3 id="constructing-a-driver-that-needs-i2c">Constructing a driver that needs i2c</h3>
<p>In this example, we will be creating a driver for the very popular, albeit
obsolete, MPU6050 inertial measurement unit (IMU) and the PWM generator
pca9685. IMUs have the capability to measure acceleration and rotational
velocity. The pca9685 can be instructed via the i2c to generate PWM signals.</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;libhal-sensor/mpu6050.hpp&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;libhal-extender/pca9685.hpp&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">application</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">hal</span><span class="o">::</span><span class="n">i2c</span><span class="o">&amp;</span><span class="w"> </span><span class="n">i2c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/* ... */</span><span class="p">;</span>
<span class="w">  </span><span class="c1">// Use default address</span>
<span class="w">  </span><span class="n">hal</span><span class="o">::</span><span class="n">sensor</span><span class="o">::</span><span class="n">mpu6050</span><span class="w"> </span><span class="n">mpu0</span><span class="p">(</span><span class="n">i2c</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// Provide your own address if your MPU6050 model has a different address</span>
<span class="w">  </span><span class="n">hal</span><span class="o">::</span><span class="n">sensor</span><span class="o">::</span><span class="n">mpu6050</span><span class="w"> </span><span class="n">mpu1</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x69</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// Use default address for the pca9685</span>
<span class="w">  </span><span class="n">hal</span><span class="o">::</span><span class="n">extender</span><span class="o">::</span><span class="n">pca9685</span><span class="w"> </span><span class="n">pca</span><span class="p">(</span><span class="n">i2c</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Many i2c devices will have multiple optional address that you can configure
them to use. Address configuration can come in many ways. Some devices use
a digital lines to set the bits of the i2c address. Some use a single pin
that can sense the voltage on the line and depending on where it is between
0V and the device's VCC, will change its address. There probably exists i2c
devices with addresses that can be configured using i2c transactions. I2c
has only 112 address. 26 of the 128 address in the 7-bit address space are
reserved. Having so few addresses means that its not uncommon to have to
deal with address conflicts.</p>
</div>
<p>In the example application, there are two MPU6050 IMUs used. Each needs access
to the i2c driver to operate. References to i2c objects can be shared between
multiple device drivers but there are rules.</p>
<h3 id="ensuring-the-correct-clock-rate">Ensuring the correct clock rate</h3>
<p>Drivers that use i2c are mandated to configure i2c to the highest possible
clock rate that their device can support. But what if devices sharing the i2c resource have different max clock rates? In that case, a solution would be to use the <code>hal::soft::minimum_speed_i2c</code> wrapper provided by <code>libhal-soft</code>:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;libhal-soft/i2c_minimum_speed.hpp&gt;</span>

<span class="n">hal</span><span class="o">::</span><span class="n">i2c</span><span class="o">&amp;</span><span class="w"> </span><span class="n">i2c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/* ... */</span><span class="p">;</span>
<span class="n">hal</span><span class="o">::</span><span class="n">soft</span><span class="o">::</span><span class="n">minimum_speed_i2c</span><span class="w"> </span><span class="nf">min_speed_i2c</span><span class="p">(</span><span class="n">i2c</span><span class="p">);</span>

<span class="n">hal</span><span class="o">::</span><span class="n">sensor</span><span class="o">::</span><span class="n">mpu6050</span><span class="w"> </span><span class="nf">mpu0</span><span class="p">(</span><span class="n">min_speed_i2c</span><span class="p">);</span>
<span class="n">hal</span><span class="o">::</span><span class="n">sensor</span><span class="o">::</span><span class="n">mpu6050</span><span class="w"> </span><span class="nf">mpu1</span><span class="p">(</span><span class="n">min_speed_i2c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x69</span><span class="p">);</span>
<span class="n">hal</span><span class="o">::</span><span class="n">extender</span><span class="o">::</span><span class="n">pca9685</span><span class="w"> </span><span class="nf">pca</span><span class="p">(</span><span class="n">min_speed_i2c</span><span class="p">);</span>

<span class="c1">// This will set the</span>
<span class="n">min_speed_i2c</span><span class="p">.</span><span class="n">set_clock_rate_to_max_common</span><span class="p">();</span>
</code></pre></div>
<p><code>hal::soft::minimum_speed_i2c</code> requires an <code>hal::i2c</code> to construct. After
creating the <code>minimum_speed_i2c</code>, use it instead of the original
driver for all of your i2c needs. <code>minimum_speed_i2c</code> will set the clock rate
of the i2c driver to <code>100kHz</code>, which is a safe default for i2c. When
<code>configure</code> is called on <code>minimum_speed_i2c</code>, it caches the lowest frequency
its seen and returns. It will NOT reconfigure the passed in i2c driver. To set
the i2c driver to the max common rate across all of the drivers that use the
shared i2c object, call <code>set_clock_rate_to_max_common()</code>.</p>
<div class="admonition critical">
<p class="admonition-title">Critical</p>
<p>The current <code>hal::soft::minimum_speed_i2c</code> does not behave is this way. It
reconfigures to the lowest speed its seen after each <code>configure</code> call. This
is problematic because it won't work on an I2C bus unless the i2c objects
are constructed in a particular order. To show the issue consider passing
an i2c to drivers A, B, and C. A has a max clock rate of 1MHz, B 400kHz and
C 100kHz. If A's constructor sets the clock rate to 1MHz and attempts talk
to the device, this could result in device B or C responding because they
misinterpreted the information in the bus.</p>
</div>
<h3 id="thread-safety">Thread safety</h3>
<div class="admonition critical">
<p class="admonition-title">Critical</p>
<p>Thread safe i2c is not currently supported. When it is added, the following
will become relevant. Its still a good read if you want to see how we
handle thread safety for i2c.</p>
</div>
<p>I2c drivers implementations do not need to consider thread safety. The
rationale for this is that thread safety is not always needed for an i2c
driver. If the application is written as a super-loop application or only one
thread uses the i2c driver, then there is no thread safety issue and thus no
need to support thread safety.</p>
<p>What happens when an application does need to use an i2c driver between threads?
One option is to use wrap anything that may use the i2c driver between threads with a mutex/lock guard:</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span><span class="w"> </span><span class="n">thread_safe_mpu_read</span><span class="p">(</span><span class="n">mpu6050</span><span class="o">&amp;</span><span class="w"> </span><span class="n">p_mpu</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="w"> </span><span class="nf">guard</span><span class="p">(</span><span class="n">my_os_mutex</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">p_mpu</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// my_display also has the shared i2c with the mpu6050 driver</span>
<span class="k">auto</span><span class="w"> </span><span class="n">thread_safe_clear_display</span><span class="p">(</span><span class="n">my_display</span><span class="o">&amp;</span><span class="w"> </span><span class="n">p_display</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="w"> </span><span class="nf">guard</span><span class="p">(</span><span class="n">my_os_mutex</span><span class="p">);</span>
<span class="w">  </span><span class="n">p_display</span><span class="p">.</span><span class="n">clear_screen</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>This can be very error prone, especially if its not obvious that a particular
driver uses the shared i2c. What we really want is access to the i2c driver to
be thread safe so drivers and application writers can focus on writing code
that works.</p>
<p><code>libhal-soft</code> provides the <code>hal::soft::thread_safe_i2c</code> wrapper which does what
it says on the tin. This is how it works:</p>
<div class="highlight"><pre><span></span><code><span class="n">hal</span><span class="o">::</span><span class="n">i2c</span><span class="o">&amp;</span><span class="w"> </span><span class="n">i2c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/* ... */</span><span class="p">;</span>
<span class="n">hal</span><span class="o">::</span><span class="n">basic_lock</span><span class="o">&amp;</span><span class="w"> </span><span class="n">i2c_lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/* ... */</span><span class="p">;</span>
<span class="n">hal</span><span class="o">::</span><span class="n">soft</span><span class="o">::</span><span class="n">thread_safe_i2c</span><span class="w"> </span><span class="nf">thread_safe_i2c</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span><span class="w"> </span><span class="n">i2c_lock</span><span class="p">);</span>

<span class="n">hal</span><span class="o">::</span><span class="n">sensor</span><span class="o">::</span><span class="n">mpu6050</span><span class="w"> </span><span class="nf">mpu0</span><span class="p">(</span><span class="n">thread_safe_i2c</span><span class="p">);</span>
<span class="n">hal</span><span class="o">::</span><span class="n">sensor</span><span class="o">::</span><span class="n">mpu6050</span><span class="w"> </span><span class="nf">mpu1</span><span class="p">(</span><span class="n">thread_safe_i2c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x69</span><span class="p">);</span>
<span class="n">hal</span><span class="o">::</span><span class="n">extender</span><span class="o">::</span><span class="n">pca9685</span><span class="w"> </span><span class="nf">pca</span><span class="p">(</span><span class="n">thread_safe_i2c</span><span class="p">);</span>
</code></pre></div>
<p><code>hal::soft::thread_safe_i2c</code> requires an <code>hal::i2c</code> and a <code>hal::basic_lock</code> to
construct. After creating the <code>thread_safe_i2c</code>, use it instead of the original
driver for all of your i2c needs. When <code>configure</code> or <code>transaction</code> is called
on <code>thread_safe_i2c</code>, it will first acquires the lock for <code>i2c_lock</code>, and after
it has acquired the lock, it dispatches the call to the original i2c driver.
Using the thread_safe_i2c ensures that all accesses to that resource are thread
safe.</p>
<p>There is one some safety issues with the code above. You can still access the original <code>i2c</code>. One could accidentally use that rather than the appropriate <code>thread_safe_i2c</code> causing a race condition. A way to get around this, is to pass the i2c and basic lock to the driver as a temporary:</p>
<div class="highlight"><pre><span></span><code><span class="n">hal</span><span class="o">::</span><span class="n">soft</span><span class="o">::</span><span class="n">thread_safe_i2c</span><span class="w"> </span><span class="nf">thread_safe_i2c</span><span class="p">(</span>
<span class="w">  </span><span class="n">hal</span><span class="o">::</span><span class="n">lpc40</span><span class="o">::</span><span class="n">i2c</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
<span class="w">  </span><span class="n">hal</span><span class="o">::</span><span class="n">freertos</span><span class="o">::</span><span class="n">basic_lock</span><span class="p">()</span>
<span class="p">);</span>

<span class="n">hal</span><span class="o">::</span><span class="n">sensor</span><span class="o">::</span><span class="n">mpu6050</span><span class="w"> </span><span class="nf">mpu0</span><span class="p">(</span><span class="n">thread_safe_i2c</span><span class="p">);</span>
<span class="n">hal</span><span class="o">::</span><span class="n">sensor</span><span class="o">::</span><span class="n">mpu6050</span><span class="w"> </span><span class="nf">mpu1</span><span class="p">(</span><span class="n">thread_safe_i2c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x69</span><span class="p">);</span>
<span class="n">hal</span><span class="o">::</span><span class="n">extender</span><span class="o">::</span><span class="n">pca9685</span><span class="w"> </span><span class="nf">pca</span><span class="p">(</span><span class="n">thread_safe_i2c</span><span class="p">);</span>
</code></pre></div>
<p>As you can see above, there is no longer an i2c instance that is accessible by
the code to call, preventing accidental use and making race conditions
impossible.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This usage of <code>hal::soft::thread_safe_i2c</code> also devirtualizes calls to
<code>hal::lpc40::i2c</code> and <code>hal::freertos::basic_lock</code>. This comes from the way
that <code>hal::soft::thread_safe_i2c</code> works. <code>hal::soft::thread_safe_i2c</code> is a
template and it captures the concrete type of the i2c and basic locks
passed to it. By knowing the concrete type, the compiler can skip the
indirection of a virtual call and call the underlying functions for the i2c
driver. Same goes for the basic_lock. This provides a slight performance
improvement. If your application has multiple <code>thread_safe_i2c</code> objects
where the input types are not all the same type, then for each unique type
combinations you get a new instance of <code>thread_safe_i2c</code>. This is typical
of class templates. Read this article to learn more:
<a href="shttps://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#t5-combine-generic-and-oo-techniques-to-amplify-their-strengths-not-their-costs">C++ Core Guidelines T.5: Combine generic and OO techniques to amplify their strengths, not their cost</a></p>
</div>
<h3 id="dealing-with-multi-controllers-on-the-bus">Dealing with multi controllers on the bus</h3>
<div class="admonition critical">
<p class="admonition-title">Critical</p>
<p>The wrappers explained here are not currently supported but will in the
future. When it is added, the following will become relevant. Its still a
good read if you want to see how we handle multiple controllers on the bus
for i2c.</p>
</div>
<p>In general, it is bad practice to have multiple controllers on the i2c bus. I2c
supports this architecture, but only one device can communicate at a time. If
another controller is using the bus, then all other controllers must wait until
that transaction is over before any other controller can use the bus.</p>
<p>But if you are in a position where you have to share an i2c bus with multiple
devices, this is how you manage that.</p>
<p>TBD</p>
<h2 id="writing-an-i2c-device-driver">Writing an i2c device driver</h2>
<p>I2c device drivers are drivers that require i2c to communicate with a chip or
system.</p>
<p>TBD</p>
<h2 id="implementing-an-i2c-driver-on-bare-metal">Implementing an i2c driver on bare metal</h2>
<p>Implementing i2c can be a bit of a process. Implementing i2c is a platform
specific bit of work, but many i2c peripherals have similar implementations.
Modern microcontrollers and system-on-chips will implement i2c in the form of a
state machine, using interrupts to notify the system that the i2c peripheral
has moved from one state to another. If the i2c implementation you are working
with does not follow the patterns described in the guide below, then you will
need to figure out how to implement the <code>hal::i2c</code> based on the data sheet
you've been provided.</p>
<p>Coming soon...</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../uart/" class="md-footer__link md-footer__link--prev" aria-label="Previous: UART">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                UART
              </div>
            </div>
          </a>
        
        
          
          <a href="../dac/" class="md-footer__link md-footer__link--next" aria-label="Next: DAC">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                DAC
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "content.tabs.link", "toc.integrate", "navigation.tracking", "navigation.footer"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>