
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../dac/">
      
      
        <link rel="next" href="../sensors/">
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>CAN BUS - libhal</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#can-bus-controller-area-network-bus" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
You're not viewing the latest version.
<a href="../../..">
  <strong>Click here to go to latest.</strong>
</a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="libhal" class="md-header__button md-logo" aria-label="libhal" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            libhal
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CAN BUS
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/libhal/libhal/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    libhal
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  üè° Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../getting_started/" class="md-tabs__link">
        
  
    
  
  üöÄ Getting Started

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../user_guide/setup_vscode/" class="md-tabs__link">
          
  
  üìñ User Guide

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../embedded_systems/" class="md-tabs__link">
          
  
  üè´ Education

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../contributor_guide/philosophy/" class="md-tabs__link">
          
  
  üìö Contributor Guides

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../project_information/status/" class="md-tabs__link">
          
  
  üìä Project Information

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../api/index.html" class="md-tabs__link">
        
  
    
  
  üß© APIs

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="libhal" class="md-nav__button md-logo" aria-label="libhal" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    libhal
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/libhal/libhal/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    libhal
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üè° Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üöÄ Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    üìñ User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            üìñ User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/setup_vscode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üßëüèø‚Äçüíª Setting up VSCode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/fundamentals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üß± Fundamentals of libhal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/interfaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üîó Interfaces in libhal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/debugging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üéØ Debugging Firmware
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/error_handling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ü™§ Error Handling in libhal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/policy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ‚öñÔ∏è Policies & FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    üè´ Education
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            üè´ Education
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../embedded_systems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What are Embedded Systems?
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bitmasking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bit Masking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Microcontroller Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gpio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    General Purpose I/O
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dma/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DMA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../timers_and_counters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Timers & Counters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ADC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PWM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SPI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../uart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UART
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../i2c/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    I2C
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DAC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    CAN BUS
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    CAN BUS
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-about-can-bus" class="md-nav__link">
    <span class="md-ellipsis">
      Learning about CAN BUS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#can-interfaces-and-how-to-use-them" class="md-nav__link">
    <span class="md-ellipsis">
      CAN interfaces and how to use them
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CAN interfaces and how to use them">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-halcan_message" class="md-nav__link">
    <span class="md-ellipsis">
      The hal::can_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-halcan_transceiver" class="md-nav__link">
    <span class="md-ellipsis">
      Using hal::can_transceiver
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using hal::can_transceiver">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#halcan_message_finder" class="md-nav__link">
    <span class="md-ellipsis">
      hal::can_message_finder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#halcan_message_reader" class="md-nav__link">
    <span class="md-ellipsis">
      hal::can_message_reader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#can-bus-device-manager" class="md-nav__link">
    <span class="md-ellipsis">
      CAN BUS device manager
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-in-device-drivers" class="md-nav__link">
    <span class="md-ellipsis">
      Usage in device drivers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage in device drivers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#interfaces-to-avoid" class="md-nav__link">
    <span class="md-ellipsis">
      Interfaces to Avoid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selecting-the-right-filter-type" class="md-nav__link">
    <span class="md-ellipsis">
      Selecting the right filter type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filter-adaptors" class="md-nav__link">
    <span class="md-ellipsis">
      Filter adaptors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#range-to-identifier-filter" class="md-nav__link">
    <span class="md-ellipsis">
      Range to identifier filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mask-to-identifier-filter" class="md-nav__link">
    <span class="md-ellipsis">
      Mask to identifier filter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#making-a-can-driver" class="md-nav__link">
    <span class="md-ellipsis">
      Making a CAN driver
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sensors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basics of Sensors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../actuators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basics of Actuators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rtos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RTOS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tbd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TBD
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    üìö Contributor Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            üìö Contributor Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributor_guide/philosophy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üìú Design Philosophy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributor_guide/organization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üóÉÔ∏è Organization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributor_guide/style/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üé® Style Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributor_guide/interface_design/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üîó Interface Design Philosophy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributor_guide/library_guides/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üîπ Library Development Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributor_guide/arm_cortex_m_bringup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üß† ARM Cortex M Bring Up
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributor_guide/dma_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ‚è© DMA Tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributor_guide/upgrade_to_libhal_3_device_library/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ‚¨ÜÔ∏è Upgrade Device Library to 3.x.y
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributor_guide/architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üèóÔ∏è Architectural Design Decisions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    üìä Project Information
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            üìä Project Information
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project_information/status/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üü¢ Library Status üî¥
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project_information/about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üß© APIs
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="can-bus-controller-area-network-bus">CAN BUS: Controller Area Network Bus</h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This document describes the CAN for libhal 5.0.0 which is not available yet.</p>
</div>
<p>Welcome to the libhal controller area network (CAN) tutorial. CAN BUS is used
as a reliable broadcast communication.</p>
<h2 id="learning-about-can-bus">Learning about CAN BUS</h2>
<p>To learn more about CAN BUS we recommend these online resources:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=JZSCzRT9TTo">üé• CAN Bus: Serial Communication - How It Works?</a>
  11m 24s video going over the basics of CAN BUS. It does not go over message
  ID arbitration which is quite important to understand with CAN BUS, but not necessary to use CAN APIs.</li>
<li><a href="https://www.ti.com/lit/an/sloa101b/sloa101b.pdf">üìÑ Introduction to the Controller Area Network (CAN) by Texas Instruments</a>:
  A fully featured document going over most of the important aspects of CAN
  bus. You'll learn everything you need to know about CAN with this document.</li>
</ul>
<h2 id="can-interfaces-and-how-to-use-them">CAN interfaces and how to use them</h2>
<p>libhal breaks CAN up into multiple interfaces and abstractions.</p>
<ul>
<li><code>hal::can_transceiver</code>: Provides APIs for sending can messages and receiving
  messages.</li>
<li><code>hal::can_message_interrupt</code>: Provides APIs for setting an interrupt when a
  message is received.</li>
<li><code>hal::can_bus_manager</code>: Provides APIs for managing the state of the can bus
  hardware.</li>
<li>Standard can filters:<ul>
<li><code>hal::can_identifier_filter</code>: Provides a means to filter can bus messages
  via a message ID.</li>
<li><code>hal::can_mask_filter</code>: Provides a means to filter can bus messages via an
  message ID and mask combo.</li>
<li><code>hal::can_range_filter</code>: Provides a means to filter can bus messages via a
  range of can message IDs</li>
</ul>
</li>
<li>Extended can filters (same as standard but for extended message IDs):<ul>
<li><code>hal::can_extended_identifier_filter</code></li>
<li><code>hal::can_extended_mask_filter</code></li>
<li><code>hal::can_extended_range_filter</code></li>
</ul>
</li>
</ul>
<p>The CAN peripheral functionality is broken up across multiple interfaces in
order to enable greater flexibility for applications, device drivers, and the
various capabilities of hardware. For example, the number of filters of each
type can vary wildly between different devices, but the predominately fit in
these three categories.</p>
<h3 id="the-halcan_message">The <code>hal::can_message</code></h3>
<p>The <code>hal::can_message</code> struct contains all of the information stored within a
typical message. The object <code>hal::can_message</code> represents a standard CAN
message in libhal. It provides all of the information you'd need in a typical
CAN message. It is used for sending and receiving messages on the can bus. Note
that the remote request and extended fields utilize bits 29th and 30th,
respectively, within the of the 32-bit <code>id_flags</code> field. The 31st bit is
reserved for now and must remain 0.</p>
<p>The can message and its APIs are defined below.</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">can_message</span>
<span class="p">{</span>
<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * @brief Memory containing the ID and remote request and extended flags</span>
<span class="cm">   *</span>
<span class="cm">   * The 31st (final) bit in this mask is reserved and must always be set to 0.</span>
<span class="cm">   * Prefer to use the accessor APIs rather than modify this field directly.</span>
<span class="cm">   *</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="n">hal</span><span class="o">::</span><span class="n">u32</span><span class="w"> </span><span class="n">id_and_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * @brief Reserve padding memory</span>
<span class="cm">   *</span>
<span class="cm">   * The size of the contents of the is struct are not a multiple of 4 meaning,</span>
<span class="cm">   * on 32-bit and above systems, this struct has a size of 16-bytes where 3 of</span>
<span class="cm">   * the bytes are padding bytes.</span>
<span class="cm">   *</span>
<span class="cm">   * These bytes are reserved and only zeros may be written to them.</span>
<span class="cm">   *</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">hal</span><span class="o">::</span><span class="n">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="w"> </span><span class="n">reserved</span><span class="p">{};</span>
<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * @brief The number of valid elements in the payload</span>
<span class="cm">   *</span>
<span class="cm">   * Can be between 0 and 8. A length value above 8 should be considered</span>
<span class="cm">   * invalid and can be discarded.</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * @brief Message data contents</span>
<span class="cm">   *</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">hal</span><span class="o">::</span><span class="n">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="o">&gt;</span><span class="w"> </span><span class="n">payload</span><span class="p">{};</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * @brief Enables default comparison</span>
<span class="cm">   *</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="o">&lt;=&gt;</span><span class="p">(</span><span class="n">can_message</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * @brief Set message ID</span>
<span class="cm">   *</span>
<span class="cm">   * @param p_id - 29 to 11 bit message ID</span>
<span class="cm">   * @return constexpr can_message&amp; - reference to self for function chaining</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="n">can_message</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">hal</span><span class="o">::</span><span class="n">u32</span><span class="w"> </span><span class="n">p_id</span><span class="p">);</span>
<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * @brief Set the messages remote request flag</span>
<span class="cm">   *</span>
<span class="cm">   * @param p_is_remote_request - set to true to set message as a remote</span>
<span class="cm">   * request.</span>
<span class="cm">   * @return constexpr can_message&amp; - reference to self for function chaining</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="n">can_message</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">remote_request</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">p_is_remote_request</span><span class="p">);</span>
<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * @brief Set the messages extended flag</span>
<span class="cm">   *</span>
<span class="cm">   * @param p_is_extended - set to true to set this message as an extended</span>
<span class="cm">   * message ID.</span>
<span class="cm">   * @return constexpr can_message&amp; - reference to self for function chaining</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="n">can_message</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">extended</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">p_is_extended</span><span class="p">);</span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="n">hal</span><span class="o">::</span><span class="n">u32</span><span class="w"> </span><span class="nf">id</span><span class="p">();</span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">remote_request</span><span class="p">();</span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">extended</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
<h3 id="using-halcan_transceiver">Using <code>hal::can_transceiver</code></h3>
<p>For now, lets set aside how we acquire a <code>hal::can_transceiver</code> and consider
what you can do once you have one.</p>
<div class="highlight"><pre><span></span><code><span class="n">u32</span><span class="w"> </span><span class="nf">baud_rate</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</code></pre></div>
<p>This function returns the baud rate in hertz of the CAN BUS. The baud rate
represents the communication rate. Common baud rates for CAN BUS are:</p>
<ul>
<li>100 kHz or Kbit/s</li>
<li>125 kHz or Kbit/s</li>
<li>250 kHz or Kbit/s</li>
<li>500 kHz or Kbit/s</li>
<li>800 kHz or Kbit/s</li>
<li>1 MHz or Mbit/s</li>
</ul>
<p>This function exists to ensure that drivers that share a <code>hal::can_transceiver</code>
can detect if the baud rate doesn't match a fixed baud rate required by another
device on the bus. CAN BUS driver may provide an out-of-interface function for
setting the baud rate, but this interface does not allow such control.</p>
<p>When a can driver is constructed it is passed a baud rate it should set itself
to. If the baud rate cannot be achieved the constructor will throw
<code>hal::argument_out_of_domain</code>. Note when setting up a CAN BUS network that
every device on the bus must have the same baud rate. The baud rate is not
changeable via the <code>hal::can_transceiver</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">send</span><span class="p">(</span><span class="n">can_message</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="w"> </span><span class="n">p_message</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</code></pre></div>
<p>The send API allows a <code>hal::can_transceiver</code> to send/broadcast messages onto
the can bus. Simply construct a <code>hal::can_message</code> and pass it to this function
and it will make its way. This function will block until the message has been
sent over the bus. This means that this API could block a thread if it never
gains access over the bus long enough to transmit its message.</p>
<div class="highlight"><pre><span></span><code><span class="n">std</span><span class="o">::</span><span class="n">span</span><span class="o">&lt;</span><span class="n">can_message</span><span class="w"> </span><span class="k">const</span><span class="o">&gt;</span><span class="w"> </span><span class="n">receive_buffer</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="nf">receive_cursor</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</code></pre></div>
<p><code>hal::can_transceiver</code> are mandated to hold a buffer can messages received over
the bus. The user is allowed, at object construction to provide buffer memory
for the driver. That buffer is then exposed by the <code>receive_buffer()</code> API to
allow applications and drivers to scan it and to find messages meant for them.
The buffer returned from <code>receive_buffer()</code> updated as a circular buffer where
the <code>receive_cursor()</code> API indicates where the driver's write cursor position
is located. Any value returned from <code>receive_cursor()</code> will always work like so:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// `can.receive_cursor()` always returns a value between 0 and</span>
<span class="c1">// `can.receive_buffer().size() - 1` meaning the following expression is always</span>
<span class="c1">// well defined. can_message is default initialized to all zeros.</span>
<span class="n">can</span><span class="p">.</span><span class="n">receive_buffer</span><span class="p">()[</span><span class="n">can</span><span class="p">.</span><span class="n">receive_cursor</span><span class="p">()];</span>
</code></pre></div>
<p>See <a href=".">‚õìÔ∏è‚Äçüí•how interface circular buffers in libhal work</a>.</p>
<p>Using the circular buffer APIs directly can be tedious and error prone, so we
provide some utility classes in <code>libhal-util/can.hpp</code>.</p>
<h4 id="halcan_message_finder"><code>hal::can_message_finder</code></h4>
<div class="highlight"><pre><span></span><code><span class="n">hal</span><span class="o">::</span><span class="n">can_transceiver</span><span class="o">&amp;</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/* ... */</span><span class="p">;</span>
<span class="n">hal</span><span class="o">::</span><span class="n">can_message_finder</span><span class="w"> </span><span class="nf">reader</span><span class="p">(</span><span class="n">can</span><span class="p">,</span><span class="w"> </span><span class="mh">0x240</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">hal</span><span class="o">::</span><span class="n">can_message</span><span class="o">&gt;</span><span class="w"> </span><span class="n">found_message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reader</span><span class="p">.</span><span class="n">find</span><span class="p">();</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">found_message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Do something with the message here...</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Message has not not been received yet</span>
<span class="p">}</span>
</code></pre></div>
<p>This helper class uses the <code>hal::can_transceiver</code> to scan the receive buffer,
relative to the position of the receive cursor, and return a copy of that
<code>hal::can_message</code> with the matching ID. Find will only find messages received
after the construction of the object. If there does not exist a message with
the ID specified, <code>std::nullopt</code> is returned. Repeated calls to <code>find()</code> will
search for messages with that ID.</p>
<p>For example, consider we have the following messages in the receive buffer post
object creation:</p>
<ol>
<li>message 0x015</li>
<li>message 0x240</li>
<li>message 0x333</li>
<li>message 0x240</li>
</ol>
<p>The first call to find will the message at index 2 and return a copy. The
second call will find the message at index 4 and return a copy. If no
additional messages are received and <code>find()</code> is called, <code>std::nullopt</code> will be
returned.</p>
<p>The lifetime of the <code>hal::can_message_reader</code> is bound to the
<code>hal::can_transceiver</code> passed to it and must not exceed the lifetime of that
<code>hal::can_transceiver</code>.</p>
<h4 id="halcan_message_reader"><code>hal::can_message_reader</code></h4>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>There are some safety concerns with this class returning a span to
something that will be modified by the transceiver.</p>
</div>
<p>Here is an example of how to use the <code>hal::can_message_reader</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">hal</span><span class="o">::</span><span class="n">can_transceiver</span><span class="o">&amp;</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/* ... */</span><span class="p">;</span>
<span class="n">hal</span><span class="o">::</span><span class="n">can_message_reader</span><span class="w"> </span><span class="nf">reader</span><span class="p">(</span><span class="n">can</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">span</span><span class="o">&lt;</span><span class="n">hal</span><span class="o">::</span><span class="n">can_message</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">new_messages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reader</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
<span class="c1">// Confirm we have messages available</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">new_messages</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Since we have some new messages, we can iterate over them and print out</span>
<span class="w">  </span><span class="c1">// their ID and length.</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">new_messages</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">hal</span><span class="o">::</span><span class="n">print</span><span class="o">&lt;</span><span class="mi">64</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;{ id: %&quot;</span><span class="w"> </span><span class="n">PRIu32</span><span class="w"> </span><span class="s">&quot;, length: %&quot;</span><span class="w"> </span><span class="n">PRIu8</span><span class="w"> </span><span class="s">&quot;}&quot;</span><span class="p">,</span>
<span class="w">                   </span><span class="n">message</span><span class="p">.</span><span class="n">id</span><span class="p">(),</span>
<span class="w">                   </span><span class="n">message</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The lifetime of the <code>hal::can_message_reader</code> is bound to the
<code>hal::can_transceiver</code> passed to it and must not exceed the lifetime of that
<code>hal::can_transceiver</code>.</p>
<h3 id="can-bus-device-manager">CAN BUS device manager</h3>
<p>In order to acquire implementations of the interfaces above, a can device
manager object should be created. How this object is created depends on your
platforms. As an example lets consider <code>stm32f103</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">namespace</span><span class="w"> </span><span class="nn">hal</span><span class="o">::</span><span class="nn">stm32f1</span><span class="w"> </span><span class="p">{</span>
<span class="k">class</span><span class="w"> </span><span class="nc">can</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">   </span><span class="c1">// Constructor</span>
<span class="w">  </span><span class="n">can</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">span</span><span class="o">&lt;</span><span class="n">hal</span><span class="o">::</span><span class="n">can_message</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p_receive_buffer</span><span class="p">,</span>
<span class="w">      </span><span class="n">can_pins</span><span class="w"> </span><span class="n">p_pins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">can_pins</span><span class="o">::</span><span class="n">pa11_pa12</span><span class="p">,</span>
<span class="w">      </span><span class="n">hal</span><span class="o">::</span><span class="n">u32</span><span class="w"> </span><span class="n">baud_rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="n">_kHz</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// The rest...</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Constructing a can object using pins PB9 &amp; PB8 on the stm32f103c8 and</span>
<span class="c1">// setting the bus baud rate to 1MHz.</span>
<span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">hal</span><span class="o">::</span><span class="n">can_message</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="o">&gt;</span><span class="w"> </span><span class="n">receive_buffer</span><span class="p">;</span>
<span class="n">hal</span><span class="o">::</span><span class="n">stm32f1</span><span class="o">::</span><span class="n">can</span><span class="w"> </span><span class="nf">can</span><span class="p">(</span><span class="n">receive_buffer</span><span class="p">,</span><span class="w"> </span><span class="n">hal</span><span class="o">::</span><span class="n">stm32f1</span><span class="o">::</span><span class="n">can_pins</span><span class="o">::</span><span class="n">pb9_pb8</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">_MHz</span><span class="p">);</span>

<span class="c1">// Acquiring resources from device manager...</span>

<span class="c1">// Typically, a can manager object only has a single transceiver, but in some</span>
<span class="c1">// cases they support messages and communication over two ports. The</span>
<span class="c1">// `transceiver` object claims the can object&#39;s transceiver resources and</span>
<span class="c1">// attempting to create another will throw the `hal::device_or_resource_busy`</span>
<span class="c1">// exception. The resource is released on the destruction of this object.</span>
<span class="k">auto</span><span class="w"> </span><span class="n">transceiver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">can</span><span class="p">.</span><span class="n">acquire_transceiver</span><span class="p">();</span>

<span class="c1">// The notes about the transceiver apply to the bus manager. There is typically</span>
<span class="c1">// only one and if you attempt to create multiple, the</span>
<span class="c1">// `hal::device_or_resource_busy` exception will be thrown.</span>
<span class="k">auto</span><span class="w"> </span><span class="n">bus_manager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">can</span><span class="p">.</span><span class="n">acquire_bus_manager</span><span class="p">();</span>

<span class="k">auto</span><span class="w"> </span><span class="n">id_filter_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">can</span><span class="p">.</span><span class="n">acquire_id_filter</span><span class="p">();</span>
<span class="k">auto</span><span class="w"> </span><span class="n">id_filter_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">can</span><span class="p">.</span><span class="n">acquire_id_filter</span><span class="p">();</span>
<span class="k">auto</span><span class="w"> </span><span class="n">id_filter_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">can</span><span class="p">.</span><span class="n">acquire_id_filter</span><span class="p">();</span>
<span class="k">auto</span><span class="w"> </span><span class="n">id_filter_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">can</span><span class="p">.</span><span class="n">acquire_id_filter</span><span class="p">();</span>
</code></pre></div>
<p>The stm32f103 only has a single CAN peripheral. Here we have to provide which
CAN TX &amp; RX pins we want to use. Next we select the baud rate in terms of
frequency.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Constructing a can object</span>
<span class="n">hal</span><span class="o">::</span><span class="n">stm32f1</span><span class="o">::</span><span class="n">can</span><span class="w"> </span><span class="nf">can</span><span class="p">(</span><span class="n">hal</span><span class="o">::</span><span class="n">stm32f1</span><span class="o">::</span><span class="n">can_pins</span><span class="o">::</span><span class="n">pb9_pb8</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">_MHz</span><span class="p">);</span>

<span class="c1">// Acquire a transceiver from the can manager object.</span>
<span class="k">auto</span><span class="w"> </span><span class="n">transceiver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">can</span><span class="p">.</span><span class="n">acquire_transceiver</span><span class="p">();</span>

<span class="c1">// Attempting to acquire a 2nd transceiver ‚ùå throws</span>
<span class="c1">// hal::device_or_resource_busy because can_transceiver is still around. If</span>
<span class="c1">// `can_transceiver` is destroyed, then this API can be used to acquire a new</span>
<span class="c1">// transceiver.</span>
<span class="k">auto</span><span class="w"> </span><span class="n">transceiver2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">can</span><span class="p">.</span><span class="n">acquire_transceiver</span><span class="p">();</span><span class="w"> </span><span class="c1">// ‚ùå</span>

<span class="c1">// Acquire a mask filter</span>
<span class="k">auto</span><span class="w"> </span><span class="n">mask_filter0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">can</span><span class="p">.</span><span class="n">acquire_mask_filter</span><span class="p">();</span>
<span class="c1">// acquire mask filters until there are no more filter resources available...</span>
<span class="k">auto</span><span class="w"> </span><span class="n">mask_filterN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">can</span><span class="p">.</span><span class="n">acquire_mask_filter</span><span class="p">();</span><span class="w">  </span><span class="c1">// ‚ùå throw</span>
</code></pre></div>
<p>If a device runs out of a the resources needed to generate an implementation
such as a filter or bus manager, that API throws <code>hal::device_or_resource_busy</code>.</p>
<p>CAN devices have a limited number of filters, each with a specific set of
resources assigned to it. When acquiring a filter, the object returned manages,
controls, and holds onto these resources for the duration of the filter's
lifetime, allowing them to be reused after the filter object is destroyed. This
means that the same resources can be used for multiple filters, but only one
filter can use a particular set of resources at any given time. Here is a
demonstration of what that would look like, assuming we only had 2 mask filters:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// ‚úÖ‚úÖ means that we have two filters available</span>
<span class="c1">// üü°‚úÖ means that one mask has been taken and the other is available</span>

<span class="c1">// START: ‚úÖ‚úÖ</span>
<span class="k">auto</span><span class="w"> </span><span class="n">mask_filter0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">can</span><span class="p">.</span><span class="n">acquire_mask_filter</span><span class="p">();</span><span class="w"> </span><span class="c1">// üü°‚úÖ</span>
<span class="p">{</span>
<span class="w">   </span><span class="k">auto</span><span class="w"> </span><span class="n">mask_filter_scoped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">can</span><span class="p">.</span><span class="n">acquire_mask_filter</span><span class="p">();</span><span class="w"> </span><span class="c1">// üü°üü°</span>
<span class="p">}</span><span class="w"> </span><span class="c1">// mask_filter_scoped resources freed üü°‚úÖ</span>
<span class="k">auto</span><span class="w"> </span><span class="n">mask_filter1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">can</span><span class="p">.</span><span class="n">acquire_mask_filter</span><span class="p">();</span><span class="w"> </span><span class="c1">// üü°üü°</span>
<span class="c1">// filters are exhausted and thus trying to create mask_filter2 results in an</span>
<span class="c1">// exception being thrown!</span>
<span class="k">auto</span><span class="w"> </span><span class="n">mask_filter2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">can</span><span class="p">.</span><span class="n">acquire_mask_filter</span><span class="p">();</span><span class="w"> </span><span class="c1">// üü°üü°‚ùå</span>
</code></pre></div>
<p>The same goes for acquiring a <code>hal::can_bus_manager</code>. Typically there is only
one and attempting to make two will throw an exception.</p>
<h2 id="usage-in-device-drivers">Usage in device drivers</h2>
<p>A typical device drivers that uses can bus interfaces will accept a
<code>hal::can_transceiver</code> and a filter. The device driver should capture the
<code>hal::can_transceiver</code> for future use and use the filter to allow messages it
expects to receive over the bus. Such a class would look like this:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">servo_controller</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="n">servo_controller</span><span class="p">(</span><span class="n">hal</span><span class="o">::</span><span class="n">can_transceiver</span><span class="o">&amp;</span><span class="w"> </span><span class="n">p_transceiver</span><span class="p">,</span>
<span class="w">                 </span><span class="n">hal</span><span class="o">::</span><span class="n">can_identifier_filter</span><span class="o">&amp;</span><span class="w"> </span><span class="n">p_filter</span><span class="p">)</span><span class="o">:</span>
<span class="w">                 </span><span class="n">m_can</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p_transceiver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">p_filter</span><span class="p">.</span><span class="n">allow</span><span class="p">(</span><span class="n">servo_message_id</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Do the rest...</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">send_position</span><span class="p">(</span><span class="n">hal</span><span class="o">::</span><span class="n">u8</span><span class="w"> </span><span class="n">p_position</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">hal</span><span class="o">::</span><span class="n">can_message</span><span class="w"> </span><span class="n">payload</span><span class="p">;</span>
<span class="w">    </span><span class="n">payload</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Assume: 0 means 0deg &amp; 255 means 360deg</span>
<span class="w">    </span><span class="n">payload</span><span class="p">.</span><span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p_position</span><span class="p">;</span>
<span class="w">    </span><span class="n">payload</span><span class="p">.</span><span class="n">id</span><span class="p">(</span><span class="n">servo_message_id</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="n">extended</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="n">remote_request</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>

<span class="w">    </span><span class="n">m_can</span><span class="o">-&gt;</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="n">hal</span><span class="o">::</span><span class="n">u32</span><span class="w"> </span><span class="n">servo_message_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x050</span><span class="p">;</span>

<span class="w">  </span><span class="n">hal</span><span class="o">::</span><span class="n">can_transceiver</span><span class="o">*</span><span class="w"> </span><span class="n">m_can</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>In general, filters do not need to be captured. Filters can be set at driver
construction and then given back to the caller. Capturing a filter is only
necessary if the filter will have its ID modified at runtime.</p>
<p>The example above assumes that the driver only ever needs to write can messages
and never needs to receive them.</p>
<h3 id="interfaces-to-avoid">Interfaces to Avoid</h3>
<p>Device drivers should not accept <code>hal::can_bus_manager</code> or
<code>hal::can_message_interrupt</code> for any API. These interfaces are reserved for use
by applications, and accepting them could lead to disruptions in other drivers
and potentially the entire system. Additionally, <code>hal::can_message_interrupt</code>
cannot be shared because it can only support a single interrupt callback,
meaning that if two drivers were provided this interface, only the last one to
set the callback would be functional, while the previous callback would be
discarded.</p>
<h3 id="receiving-messages">Receiving messages</h3>
<p>When you want to also receive messages over CAN prefer to capture the
<code>hal::can_transceiver</code> via <code>hal::can_message_finder</code>. It will supply the memory
to capture the <code>hal::can_transceiver</code> and provide the necessary memory to track
new incoming messages from the <code>hal::can_transceiver</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">battery_sensor</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="n">battery_sensor</span><span class="p">(</span><span class="n">hal</span><span class="o">::</span><span class="n">can_transceiver</span><span class="o">&amp;</span><span class="w"> </span><span class="n">p_transceiver</span><span class="p">,</span>
<span class="w">                 </span><span class="n">hal</span><span class="o">::</span><span class="n">can_identifier_filter</span><span class="o">&amp;</span><span class="w"> </span><span class="n">p_filter</span><span class="p">)</span><span class="o">:</span>
<span class="w">                 </span><span class="n">m_can</span><span class="p">(</span><span class="n">p_transceiver</span><span class="p">,</span><span class="w"> </span><span class="n">battery_response_message_id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">p_filter</span><span class="p">.</span><span class="n">allow</span><span class="p">(</span><span class="n">battery_response_message_id</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Do the rest...</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">request_battery_capacity</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">hal</span><span class="o">::</span><span class="n">can_message</span><span class="w"> </span><span class="n">payload</span><span class="p">;</span>

<span class="w">    </span><span class="n">payload</span><span class="p">.</span><span class="n">id</span><span class="p">(</span><span class="n">battery_message_id</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="n">extended</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="n">remote_request</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
<span class="w">    </span><span class="n">payload</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="n">m_can</span><span class="p">.</span><span class="n">transceiver</span><span class="p">().</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">get_battery_capacity</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_can</span><span class="p">.</span><span class="n">find</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">message</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kt">float</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">255.0f</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="n">hal</span><span class="o">::</span><span class="n">u32</span><span class="w"> </span><span class="n">battery_message_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x050</span><span class="p">;</span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="n">hal</span><span class="o">::</span><span class="n">u32</span><span class="w"> </span><span class="n">battery_response_message_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x050</span><span class="p">;</span>

<span class="w">  </span><span class="n">hal</span><span class="o">::</span><span class="n">can_message_finder</span><span class="w"> </span><span class="n">m_can</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>The transceiver can be accessed using the <code>transceiver()</code> API.</p>
<h3 id="selecting-the-right-filter-type">Selecting the right filter type</h3>
<ol>
<li>Select <code>hal::can_identifier_filter</code> if the device driver only needs to
   filter a single standard message ID.</li>
<li>Select <code>hal::can_extended_identifier_filter</code> if the device driver only needs
   to filter a single extended message ID.</li>
<li>Select <code>hal::can_range_filter</code> if the device driver expects to see messages
   in a range of standard message IDs.</li>
<li>Select <code>hal::can_extended_range_filter</code> if the device driver expects to see
   messages in a range of standard message IDs.</li>
<li>Select <code>hal::can_mask_filter</code> if the device driver expects to see messages
   that fit a standard identifier with some bits that can change. In general,
   this filter type isn't particular useful for device drivers.</li>
<li>Select <code>hal::can_extended_mask_filter</code> if the device driver expects to see
   messages that fit an extended identifier with some bits that can change. In
   general, this filter type isn't particular useful for device drivers.</li>
</ol>
<h3 id="filter-adaptors">Filter adaptors</h3>
<p>Can peripherals may not provide all of the filters needed by device drivers or
application. In these cases, we can use an adaptor from <code>libhal-util</code> to
convert one filter to another.</p>
<h3 id="range-to-identifier-filter">Range to identifier filter</h3>
<p>libhal provides <code>hal::range_to_identifier_can_adaptor</code> which can take a
<code>hal::can_range_filter</code> and generate multiple <code>hal::can_identifier_filters</code>.
This can be beneficial when the set of IDs is contiguous OR close enough
together.</p>
<div class="highlight"><pre><span></span><code><span class="n">hal</span><span class="o">::</span><span class="n">can_range_filter</span><span class="o">&amp;</span><span class="w"> </span><span class="n">range_filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/* ... */</span><span class="p">;</span>
<span class="n">hal</span><span class="o">::</span><span class="n">range_to_identifier_can_adaptor</span><span class="w"> </span><span class="nf">id_generator</span><span class="p">(</span><span class="n">range_filter</span><span class="p">);</span>
<span class="k">auto</span><span class="w"> </span><span class="n">id_filter_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id_generator</span><span class="p">.</span><span class="n">create</span><span class="p">();</span>
<span class="k">auto</span><span class="w"> </span><span class="n">id_filter_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id_generator</span><span class="p">.</span><span class="n">create</span><span class="p">();</span>
<span class="k">auto</span><span class="w"> </span><span class="n">id_filter_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id_generator</span><span class="p">.</span><span class="n">create</span><span class="p">();</span>

<span class="n">id_filter_1</span><span class="p">.</span><span class="n">allow</span><span class="p">(</span><span class="mh">0x111</span><span class="p">);</span><span class="w"> </span><span class="c1">// range 0x111 ‚Üî 0x111</span>
<span class="n">id_filter_2</span><span class="p">.</span><span class="n">allow</span><span class="p">(</span><span class="mh">0x112</span><span class="p">);</span><span class="w"> </span><span class="c1">// range 0x111 ‚Üî 0x112</span>
<span class="n">id_filter_3</span><span class="p">.</span><span class="n">allow</span><span class="p">(</span><span class="mh">0x117</span><span class="p">);</span><span class="w"> </span><span class="c1">// range 0x111 ‚Üî 0x117</span>
<span class="n">id_filter_3</span><span class="p">.</span><span class="n">allow</span><span class="p">(</span><span class="mh">0x110</span><span class="p">);</span><span class="w"> </span><span class="c1">// range 0x110 ‚Üî 0x115</span>
<span class="n">id_filter_3</span><span class="p">.</span><span class="n">allow</span><span class="p">(</span><span class="mh">0x116</span><span class="p">);</span><span class="w"> </span><span class="c1">// range 0x110 ‚Üî 0x115 (no change)</span>
</code></pre></div>
<p>Each id generated links back to the <code>hal::range_to_identifier_can_adaptor</code>
object. They are bound by its lifetime. Each time a filter calls <code>allow()</code>, it
expands the range to fit the max and min values passed previously.</p>
<p>The filter is not as useful if the range between IDs is large and there are
messages within that ID range.</p>
<p>There exist an equivalent for extended IDs.</p>
<h3 id="mask-to-identifier-filter">Mask to identifier filter</h3>
<p>libhal provides <code>hal::mask_to_identifier_can_adaptor</code> which can take a
<code>hal::can_mask_filter</code> and generate multiple <code>hal::can_identifier_filters</code>.</p>
<p>TBD...</p>
<h2 id="making-a-can-driver">Making a CAN driver</h2>
<p>TBD...</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../dac/" class="md-footer__link md-footer__link--prev" aria-label="Previous: DAC">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                DAC
              </div>
            </div>
          </a>
        
        
          
          <a href="../sensors/" class="md-footer__link md-footer__link--next" aria-label="Next: Basics of Sensors">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Basics of Sensors
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "content.tabs.link", "toc.integrate", "navigation.tracking", "navigation.footer"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
    
  </body>
</html>